"""
‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‚Äî ‡∏à‡∏î‡∏à‡∏≥‡∏¢‡∏≤ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠ ‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ memU ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≤ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠ ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡∏û‡∏£‡πâ‡∏≠‡∏° pseudocode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á LINE reminder

‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:
    export OPENAI_API_KEY=your_api_key
    python examples/community/02_elderly_care.py
"""

import asyncio
import os

from memu.app import MemoryService as MemUService

# ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏°‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á)
‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ = """
‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•: ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏™‡∏°‡∏ä‡∏≤‡∏¢ (‡∏≠‡∏≤‡∏¢‡∏∏ 72 ‡∏õ‡∏µ)

‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥:
1. ‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô Amlodipine 5mg ‚Äî ‡∏Å‡∏¥‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
2. ‡∏¢‡∏≤‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô Metformin 500mg ‚Äî ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ä‡πâ‡∏≤-‡πÄ‡∏¢‡πá‡∏ô ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
3. ‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô B1 ‚Äî ‡∏Å‡∏¥‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô

‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ:
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2568
- ‡∏´‡∏°‡∏≠: ‡∏ô‡∏û.‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à
- ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•: ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏£‡∏≤
- ‡πÅ‡∏ú‡∏ô‡∏Å: ‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°

‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°:
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 10 ‡∏Å.‡∏û. ‚Äî ‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô 145/90
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 12 ‡∏Å.‡∏û. ‚Äî ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ 128/80
- ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î: ‡πÄ‡∏ä‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ 126 mg/dL
"""

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£ = """
‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏™‡∏°‡∏ä‡∏≤‡∏¢:
- ‡∏ï‡∏∑‡πà‡∏ô 06:00 ‚Äî ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤
- 07:00 ‚Äî ‡πÄ‡∏î‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ 30 ‡∏ô‡∏≤‡∏ó‡∏µ
- 12:00 ‚Äî ‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á (‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ñ‡πá‡∏°)
- 18:00 ‚Äî ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏¢‡πá‡∏ô
- 21:00 ‚Äî ‡∏ô‡∏≠‡∏ô

‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡πá‡∏° ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô ‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°
"""


async def ‡∏™‡πà‡∏á_LINE_reminder(‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: str, user_line_id: str = "Uxxxxxx"):
    """
    Pseudocode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á LINE reminder
    ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á: ‡πÉ‡∏ä‡πâ LINE Messaging API
    """
    print(f"\nüì± [LINE Pseudocode] ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á {user_line_id}:")
    print(f"   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: {‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°}")
    # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á:
    # import httpx
    # headers = {"Authorization": f"Bearer {LINE_CHANNEL_TOKEN}"}
    # body = {"to": user_line_id, "messages": [{"type": "text", "text": ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°}]}
    # await httpx.AsyncClient().post("https://api.line.me/v2/bot/message/push",
    #                                 headers=headers, json=body)


async def main():
    print("‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‚Äî ‡∏à‡∏î‡∏à‡∏≥‡∏¢‡∏≤ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠ ‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û")
    print("-" * 50)

    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        raise ValueError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ OPENAI_API_KEY")

    ‡∏´‡∏°‡∏ß‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ = [
        {"name": "‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤", "description": "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ ‡∏Ç‡∏ô‡∏≤‡∏î ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏¥‡∏ô"},
        {"name": "‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠", "description": "‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏≠ ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å"},
        {"name": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "description": "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•"},
        {"name": "‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô", "description": "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏ô-‡∏ô‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢"},
    ]

    service = MemUService(
        llm_profiles={"default": {"api_key": api_key, "chat_model": "gpt-4o-mini"}},
        memorize_config={"memory_categories": ‡∏´‡∏°‡∏ß‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥},
    )

    # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
    print("\nüíä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û...")
    os.makedirs("/tmp/memu_elderly", exist_ok=True)

    for ‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ in [("‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠.txt", ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤), ("‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£.txt", ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£)]:
        ‡πÑ‡∏ü‡∏•‡πå = f"/tmp/memu_elderly/{‡∏ä‡∏∑‡πà‡∏≠}"
        with open(‡πÑ‡∏ü‡∏•‡πå, "w", encoding="utf-8") as f:
            f.write(‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)
        try:
            await service.memorize(resource_url=‡πÑ‡∏ü‡∏•‡πå, modality="document")
            print(f"  ‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å {‡∏ä‡∏∑‡πà‡∏≠} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")
        except Exception as e:
            print(f"  ‚úó ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: {e}")

    # ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
    print("\nüîç ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...")
    ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° = [
        "‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?",
        "‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£?",
        "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?",
    ]

    for ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠ in ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:
        print(f"\n‚ùì ‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤: {‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠}")
        try:
            ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå = await service.retrieve(queries=[{"role": "user", "content": ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠}])
            ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö = ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå.get("answer", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
            print(f"ü§ñ ‡∏ï‡∏≠‡∏ö: {‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö}")
        except Exception as e:
            print(f"  ‚úó ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: {e}")

    # ‡∏™‡πà‡∏á reminder ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
    await ‡∏™‡πà‡∏á_LINE_reminder("‚è∞ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤")
    await ‡∏™‡πà‡∏á_LINE_reminder("üìÖ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°! ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠‡∏´‡∏°‡∏≠‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°")

    print("\n‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô")


if __name__ == "__main__":
    asyncio.run(main())
