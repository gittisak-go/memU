[🏠 หน้าหลัก](../../README.md) | [📚 สารบัญ](README.md)

---

# บทที่ 2: แนวคิดหลัก

## 3 ชั้นของหน่วยความจำ

memU จัดระเบียบหน่วยความจำเป็น 3 ชั้น เหมือน file system ที่มีลำดับชั้น:

```
┌─────────────────────────────────────────────────┐
│                   CATEGORY                      │
│   (ภาพรวม / สรุป / auto-organized topics)       │
│                                                 │
│   ┌───────────────────────────────────────────┐ │
│   │              MEMORY ITEM                  │ │
│   │   (ข้อเท็จจริง / ความชอบ / ทักษะ)         │ │
│   │                                           │ │
│   │   ┌───────────────────────────────────┐   │ │
│   │   │           RESOURCE                │   │ │
│   │   │   (ต้นฉบับ: บทสนทนา / เอกสาร /  │   │ │
│   │   │    ภาพ / วิดีโอ / audio)          │   │ │
│   │   └───────────────────────────────────┘   │ │
│   └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

### ชั้นที่ 1: Resource

**Resource** คือข้อมูลดิบต้นฉบับที่ป้อนเข้าระบบ

| ประเภท (modality) | คำอธิบาย | ตัวอย่าง |
|-----------------|---------|---------|
| `conversation` | ไฟล์ JSON บทสนทนา | `conv1.json` |
| `document` | เอกสารข้อความ | `readme.txt`, `manual.pdf` |
| `image` | ไฟล์ภาพ | `diagram.png`, `screenshot.jpg` |
| `video` | ไฟล์วิดีโอ | `tutorial.mp4` |
| `audio` | ไฟล์เสียง | `meeting.mp3` |

**ตัวอย่างใน code**:
```python
# ป้อน resource เข้าระบบด้วย memorize()
result = await service.memorize(
    resource_url="examples/resources/conversations/conv1.json",
    modality="conversation",  # ระบุ modality
    user={"user_id": "alice"},
)

# resource ที่จัดเก็บจะอยู่ใน result["resource"]
resource = result["resource"]
print(f"Resource ID: {resource.get('id')}")
print(f"URL: {resource.get('url')}")
```

---

### ชั้นที่ 2: Memory Item

**Memory Item** คือข้อมูลที่สกัด (extract) ออกมาจาก resource

แต่ละ item มี:
- `summary` — สรุปสั้นๆ ของข้อมูล
- `memory_type` — ประเภท (fact, preference, skill, etc.)
- `embedding` — vector representation สำหรับ semantic search
- `user_id` / `agent_id` — ขอบเขตผู้ใช้/agent

**ตัวอย่าง items ที่สกัดจากบทสนทนา**:
```
"ผู้ใช้ชอบ dark mode"              ← preference
"ผู้ใช้เชี่ยวชาญ Python"           ← skill
"นัดประชุม 3 มีนาคม เวลา 14:00"   ← fact
"ต้องการรายงาน Q1 ภายในสัปดาห์นี้" ← task
```

**ดึง items**:
```python
items = result.get("items", [])
for item in items:
    print(f"Type: {item.get('memory_type')}")
    print(f"Summary: {item.get('summary')}")
```

---

### ชั้นที่ 3: Category

**Category** คือกลุ่มหัวข้อที่ memU จัดระเบียบอัตโนมัติ เหมือน folder

แต่ละ category มี:
- `name` — ชื่อ category (เช่น `preferences`, `work_context`)
- `description` — คำอธิบาย
- `summary` — สรุปรวมของ items ในกลุ่มนี้

**ตัวอย่าง auto-generated categories**:
```python
categories = result.get("categories", [])
for cat in categories:
    print(f"📁 {cat['name']}")
    print(f"   {cat.get('summary', '')[:100]}")
```

ผลลัพธ์:
```
📁 preferences
   ผู้ใช้ชอบ dark mode ในทุก interface และต้องการ notifications น้อยๆ...
📁 technical_skills
   เชี่ยวชาญ Python, JavaScript และ React มีประสบการณ์ 5 ปี...
📁 work_context
   ทำงานใน startup fintech ตำแหน่ง senior developer...
```

---

## Proactive vs Reactive

### Reactive Memory (ตอบสนอง)

ระบบตอบสนองต่อคำสั่งที่ชัดเจน:

```python
# ❓ ผู้ใช้ถาม → ระบบตอบ
result = await service.retrieve(
    queries=[{"role": "user", "content": {"text": "ฉันชอบอะไร?"}}],
    where={"user_id": "alice"},
)
```

**ใช้เมื่อ**: ต้องการตอบคำถามเฉพาะ, ดึงข้อมูลตามคำขอ

### Proactive Memory (เชิงรุก)

ระบบทำงานเองโดยไม่รอคำสั่ง:

```
┌─────────────────────────────────────────────────────┐
│                    USER QUERY                       │
└─────────────────────────────────────────────────────┘
         │                           │
         ▼                           ▼
┌─────────────────┐         ┌─────────────────────────┐
│   MAIN AGENT    │         │       MEMU BOT           │
│                 │  ◄────► │  ทำงานพื้นหลัง:         │
│  ตอบ query      │         │  - จำ patterns           │
│  รัน tasks      │         │  - คาดเดาความต้องการ    │
└─────────────────┘         │  - เตรียม context ล่วง  │
                             │    หน้า                 │
                             └─────────────────────────┘
```

**ใช้เมื่อ**: Agent ต้องทำงานต่อเนื่อง, ระบบต้องการเรียนรู้อัตโนมัติ

**ตัวอย่างการใช้งานเชิงรุก**:
```bash
cd examples/proactive
python proactive.py
```

---

## Memory Lifecycle

วงจรชีวิตของข้อมูลความจำตั้งแต่รับเข้าจนถึงดึงออก:

```
INPUT
  │
  ▼
┌─────────────────────────────────┐
│  1. INGEST (รับข้อมูลเข้า)      │
│  resource_url + modality        │
│  → ดาวน์โหลด/อ่านไฟล์           │
│  → แปลงเป็น text/embedding      │
└─────────────────┬───────────────┘
                  │
                  ▼
┌─────────────────────────────────┐
│  2. EXTRACT (สกัดข้อมูล)        │
│  LLM วิเคราะห์ content          │
│  → สร้าง Memory Items           │
│  → กำหนด memory_type           │
│  → สร้าง embeddings             │
└─────────────────┬───────────────┘
                  │
                  ▼
┌─────────────────────────────────┐
│  3. CATEGORIZE (จัดหมวดหมู่)    │
│  จัดกลุ่ม items อัตโนมัติ       │
│  → อัปเดต Category summaries   │
│  → สร้าง cross-references       │
└─────────────────┬───────────────┘
                  │
                  ▼
┌─────────────────────────────────┐
│  4. STORE (จัดเก็บ)             │
│  บันทึกใน database              │
│  → metadata (SQLite/PostgreSQL) │
│  → embeddings (vector index)   │
└─────────────────┬───────────────┘
                  │
                  ▼
┌─────────────────────────────────┐
│  5. RETRIEVE (ดึงออก)           │
│  method="rag" หรือ "llm"        │
│  → semantic search              │
│  → score & rank                 │
│  → return context               │
└─────────────────────────────────┘
```

---

## User Intent Capture

หนึ่งในความสามารถพิเศษของ memU คือการ **จับเจตนาผู้ใช้** แม้ผู้ใช้ไม่ได้พูดตรงๆ

### วิธีที่ memU จับเจตนา

1. **Pattern Detection**: วิเคราะห์ patterns ซ้ำๆ ในบทสนทนา
2. **Context Accumulation**: สะสม context ข้ามหลายเซสชัน
3. **Preference Learning**: เรียนรู้ความชอบจากพฤติกรรม
4. **Next-Step Prediction**: คาดเดาขั้นตอนถัดไปจาก context

**ตัวอย่าง**:
```
เซสชัน 1: "ช่วยหาข้อมูลเกี่ยวกับ React hooks"
เซสชัน 2: "อธิบาย useEffect ให้ฉันฟัง"
เซสชัน 3: "ฉันติด bug ใน useState"

→ memU จับได้ว่า: ผู้ใช้กำลังเรียน React
→ คาดเดา: น่าจะต้องการข้อมูลเกี่ยวกับ React context API ถัดไป
→ เตรียม: pre-fetch relevant memories เกี่ยวกับ React
```

---

## ภาพรวมการทำงาน: Main Agent ↔ MemU Bot ↔ DB

```
┌──────────────────────────────────────────────────────────────────┐
│                        USER INTERACTION                          │
└──────────────────────────────────────────────────────────────────┘
           │                                        │
           ▼                                        ▼
┌──────────────────────┐              ┌─────────────────────────────┐
│     MAIN AGENT       │              │        MEMU BOT             │
│                      │              │                             │
│ • รับ query          │◄────────────►│ • ติดตาม interactions       │
│ • วางแผนงาน          │   sync       │ • สกัด memories             │
│ • เรียก tools        │              │ • อัปเดต categories         │
│ • สร้างคำตอบ         │              │ • คาดเดาเจตนา               │
│                      │              │ • inject context            │
└──────────┬───────────┘              └──────────┬──────────────────┘
           │                                      │
           └──────────────────┬───────────────────┘
                              │
                              ▼
               ┌──────────────────────────────┐
               │          DATABASE            │
               │                              │
               │  ┌────────────────────────┐  │
               │  │  Resources Table       │  │
               │  │  (raw input metadata)  │  │
               │  └────────────────────────┘  │
               │  ┌────────────────────────┐  │
               │  │  Memory Items Table    │  │
               │  │  (extracted facts)     │  │
               │  └────────────────────────┘  │
               │  ┌────────────────────────┐  │
               │  │  Categories Table      │  │
               │  │  (organized summaries) │  │
               │  └────────────────────────┘  │
               │  ┌────────────────────────┐  │
               │  │  Vector Index          │  │
               │  │  (embeddings for RAG)  │  │
               │  └────────────────────────┘  │
               └──────────────────────────────┘
```

---

## ขั้นตอนถัดไป

- 📖 [บทที่ 3: API อ้างอิง](03-API-อ้างอิง.md) — รายละเอียด parameters ทั้งหมด
- 📖 [บทที่ 4: ตัวอย่างจริง](04-ตัวอย่างจริง.md) — โค้ดตัวอย่างจาก repo จริง
